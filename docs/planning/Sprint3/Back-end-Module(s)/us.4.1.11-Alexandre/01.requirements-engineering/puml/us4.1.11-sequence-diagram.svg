<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="942px" preserveAspectRatio="none" style="width:1432px;height:942px;background:#FFFFFF;" version="1.1" viewBox="0 0 1432 942" width="1432px" zoomAndPan="magnify"><title>System Sequence Diagram - Mark VVE as Completed (US4.1.11)</title><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="504.2324" x="460.2717" y="27.9951">System Sequence Diagram - Mark VVE as Completed (US4.1.11)</text><rect fill="none" height="321.2656" style="stroke:#000000;stroke-width:1.5;" width="1405.7759" x="10" y="331.6563"/><rect fill="none" height="105.3359" style="stroke:#000000;stroke-width:1.5;" width="666.5977" x="10" y="739.1875"/><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Operator" id="part1-lifeline"><g><title>Logistics Operator</title><rect fill="#000000" fill-opacity="0.00000" height="742.9297" width="8" x="82.9604" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="86" x2="86" y1="118.5938" y2="861.5234"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="System" id="part2-lifeline"><g><title>VVE Management API</title><rect fill="#000000" fill-opacity="0.00000" height="742.9297" width="8" x="583.9614" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="587.3252" x2="587.3252" y1="118.5938" y2="861.5234"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="VVERepo" id="part3-lifeline"><g><title>VVERepo</title><rect fill="#000000" fill-opacity="0.00000" height="742.9297" width="8" x="1362.8794" y="118.5938"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1365.9829" x2="1365.9829" y1="118.5938" y2="861.5234"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Operator" id="part1-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.9209" x="20" y="115.292">Logistics Operator</text><ellipse cx="86.9604" cy="50.7969" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M86.9604,58.7969 L86.9604,85.7969 M73.9604,66.7969 L99.9604,66.7969 M86.9604,85.7969 L73.9604,100.7969 M86.9604,85.7969 L99.9604,100.7969" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Operator" id="part1-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.9209" x="20" y="873.5186">Logistics Operator</text><ellipse cx="86.9604" cy="885.3203" fill="#E3E3E3" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M86.9604,893.3203 L86.9604,920.3203 M73.9604,901.3203 L99.9604,901.3203 M86.9604,920.3203 L73.9604,935.3203 M86.9604,920.3203 L99.9604,935.3203" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="System" id="part2-head"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.2725" x="509.3252" y="115.292">VVE Management API</text><path d="M567.4614,74.2969 L567.4614,98.2969 M567.4614,86.2969 L584.4614,86.2969" fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="596.4614" cy="86.2969" fill="#E3E3E3" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="System" id="part2-tail"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151.2725" x="509.3252" y="873.5186">VVE Management API</text><path d="M567.4614,880.8203 L567.4614,904.8203 M567.4614,892.8203 L584.4614,892.8203" fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="596.4614" cy="892.8203" fill="#E3E3E3" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="VVERepo" id="part3-head"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.793" x="1327.9829" y="87.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.793" x="1334.9829" y="107.292">VVERepo</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="VVERepo" id="part3-tail"><rect fill="#E3E3E3" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="77.793" x="1327.9829" y="860.5234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63.793" x="1334.9829" y="880.5186">VVERepo</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1425.7759" x="0" y="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1425.7759" y1="149.1602" y2="149.1602"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1425.7759" y1="152.1602" y2="152.1602"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="193.3149" x="616.2305" y="138.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="174.7891" x="622.2305" y="154.6606">Mark VVE as Completed</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg1"><polygon fill="#181818" points="575.9614,237.2578,585.9614,241.2578,575.9614,245.2578,579.9614,241.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="86.9604" x2="581.9614" y1="241.2578" y2="241.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.6387" x="93.9604" y="221.0591">POST /api/vves/{vveId}/complete</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="424.5884" x="93.9604" y="236.1919">Body: {actualUnBerthTime, actualLeavePortTime, updaterEmail}</text></g><path d="M592,176.7266 L592,276.7266 L1118,276.7266 L1118,186.7266 L1108,176.7266 L592,176.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M1108,176.7266 L1108,186.7266 L1118,186.7266 L1108,176.7266" fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.6294" x="598" y="193.7935">Requires:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.686" x="598" y="208.9263">- VVE must be "In Progress"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="505.9717" x="598" y="224.0591">- All cargo operations must be completed (checked via OperationPlanService)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.5767" x="598" y="239.1919">- Dates must satisfy:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="263.4849" x="606.2646" y="254.3247">actualUnBerthTime &gt;= actualBerthTime</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293.0205" x="606.2646" y="269.4575">actualLeavePortTime &gt;= actualUnBerthTime</text><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg3"><line style="stroke:#181818;stroke-width:1;" x1="587.9614" x2="629.9614" y1="303.6563" y2="303.6563"/><line style="stroke:#181818;stroke-width:1;" x1="629.9614" x2="629.9614" y1="303.6563" y2="316.6563"/><line style="stroke:#181818;stroke-width:1;" x1="588.9614" x2="629.9614" y1="316.6563" y2="316.6563"/><polygon fill="#181818" points="598.9614,312.6563,588.9614,316.6563,598.9614,320.6563,594.9614,316.6563" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298.6763" x="594.9614" y="298.5903">Check all cargo operations completed for VVE</text></g><path d="M10,331.6563 L74.4429,331.6563 L74.4429,338.7891 L64.4429,348.7891 L10,348.7891 L10,331.6563" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="321.2656" style="stroke:#000000;stroke-width:1.5;" width="1405.7759" x="10" y="331.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="344.7231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="190.4697" x="89.4429" y="343.8667">[Not all operations completed]</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg4"><polygon fill="#181818" points="97.9604,381.0547,87.9604,385.0547,97.9604,389.0547,93.9604,385.0547" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="91.9604" x2="586.9614" y1="385.0547" y2="385.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111.6045" x="103.9604" y="364.856">400 Bad Request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="477.001" x="103.9604" y="379.9888">Body: { message: "Cannot complete VVE: unfinished cargo operations" }</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="1415.7759" y1="394.0547" y2="394.0547"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="165.709" x="15" y="404.2651">[All operations completed]</text><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg5"><line style="stroke:#181818;stroke-width:1;" x1="587.9614" x2="629.9614" y1="428.9922" y2="428.9922"/><line style="stroke:#181818;stroke-width:1;" x1="629.9614" x2="629.9614" y1="428.9922" y2="441.9922"/><line style="stroke:#181818;stroke-width:1;" x1="588.9614" x2="629.9614" y1="441.9922" y2="441.9922"/><polygon fill="#181818" points="598.9614,437.9922,588.9614,441.9922,598.9614,445.9922,594.9614,441.9922" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="764.918" x="594.9614" y="423.9263">Call VesselVisitExecutionService.setCompletedAsync(vveId, actualUnBerthTime, actualLeavePortTime, updaterEmail)</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg6"><polygon fill="#181818" points="1354.8794,467.125,1364.8794,471.125,1354.8794,475.125,1358.8794,471.125" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="587.9614" x2="1360.8794" y1="471.125" y2="471.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104.146" x="594.9614" y="466.0591">Fetch VVE by ID</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg7"><polygon fill="#181818" points="598.9614,496.2578,588.9614,500.2578,598.9614,504.2578,594.9614,500.2578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="592.9614" x2="1365.8794" y1="500.2578" y2="500.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67.8691" x="604.9614" y="495.1919">VVE entity</text></g><g class="message" data-entity-1="part2" data-entity-2="part2" id="msg8"><line style="stroke:#181818;stroke-width:1;" x1="587.9614" x2="629.9614" y1="529.3906" y2="529.3906"/><line style="stroke:#181818;stroke-width:1;" x1="629.9614" x2="629.9614" y1="529.3906" y2="542.3906"/><line style="stroke:#181818;stroke-width:1;" x1="588.9614" x2="629.9614" y1="542.3906" y2="542.3906"/><polygon fill="#181818" points="598.9614,538.3906,588.9614,542.3906,598.9614,546.3906,594.9614,542.3906" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="531.1909" x="594.9614" y="524.3247">Update VVE: set actualUnBerthTime, actualLeavePortTime, status = "Completed"</text></g><g class="message" data-entity-1="part2" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="1354.8794,567.5234,1364.8794,571.5234,1354.8794,575.5234,1358.8794,571.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="587.9614" x2="1360.8794" y1="571.5234" y2="571.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120.231" x="594.9614" y="566.4575">Save updated VVE</text></g><g class="message" data-entity-1="part3" data-entity-2="part2" id="msg10"><polygon fill="#181818" points="598.9614,596.6563,588.9614,600.6563,598.9614,604.6563,594.9614,600.6563" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="592.9614" x2="1365.8794" y1="600.6563" y2="600.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.8193" x="604.9614" y="595.5903">Persisted VVE</text></g><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg11"><polygon fill="#181818" points="97.9604,640.9219,87.9604,644.9219,97.9604,648.9219,93.9604,644.9219" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="91.9604" x2="586.9614" y1="644.9219" y2="644.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="103.9604" y="624.7231">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="159.1104" x="103.9604" y="639.856">Body: Updated VVE DTO</text></g><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1;" width="1425.7759" x="0" y="680.4883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1425.7759" y1="680.4883" y2="680.4883"/><line style="stroke:#000000;stroke-width:1;" x1="0" x2="1425.7759" y1="683.4883" y2="683.4883"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2;" width="205.4644" x="610.1558" y="669.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186.9385" x="616.1558" y="685.9888">View Audit Log (optional)</text><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg12"><polygon fill="#181818" points="575.9614,720.1875,585.9614,724.1875,575.9614,728.1875,579.9614,724.1875" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="86.9604" x2="581.9614" y1="724.1875" y2="724.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="183.0474" x="93.9604" y="719.1216">GET /api/vves/{vveId}/audit</text></g><path d="M10,739.1875 L74.4429,739.1875 L74.4429,746.3203 L64.4429,756.3203 L10,756.3203 L10,739.1875" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="105.3359" style="stroke:#000000;stroke-width:1.5;" width="666.5977" x="10" y="739.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="19.4429" x="25" y="752.2544">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="83.0103" x="89.4429" y="751.3979">[Audit found]</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg13"><polygon fill="#181818" points="97.9604,788.5859,87.9604,792.5859,97.9604,796.5859,93.9604,792.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="91.9604" x2="586.9614" y1="792.5859" y2="792.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="47.7026" x="103.9604" y="772.3872">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153.8228" x="103.9604" y="787.52">Body: VVE audit entries</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="676.5977" y1="801.5859" y2="801.5859"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="98.7798" x="15" y="811.7964">[VVE not found]</text><g class="message" data-entity-1="part2" data-entity-2="part1" id="msg14"><polygon fill="#181818" points="97.9604,832.5234,87.9604,836.5234,97.9604,840.5234,93.9604,836.5234" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="91.9604" x2="586.9614" y1="836.5234" y2="836.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96.0146" x="103.9604" y="831.4575">404 Not Found</text></g><!--SRC=[dLJ1Rjf04BtlLuny2b88ISN94f5881LgKb09d7hPh0Tx5NlNtLsJMb7-lREBRKWBRTGBWjatC-_DFCO-IrLommiejD8YCxf0SAP2PhiNc_54lqYLmeRd5fcJBaTOrjPX0KlyKQ4I21F9Ku_kmmCtpx1UJu5RkDL5cQF31CvMo-75rSNLLOynBfms4DthL5edXOLvYOPJBF8vxG_sf2kLS5D3vAizSCLJB50v62zc0RdZmDXeTABfQCJQQj2_RZd7i9Wl7s70IpdORj4ENkbpbhmDH9FuNTtef8xXbOXMF5-f6pGkUvG5diCkT8zyYmjjt2vObGbtQAO5b_aRKzeX69bcZdsZyKY3DcRzmAweh8CdX6YcO65qIaysehTndeFW9jMW0r-fbUt0OZz4aQ5ufYzRoPiv4NAHSxL4ivK2UrHhGbIQP4llTbF73E0FAN0zQe9Tg8EzaxS77cGpL0bueOmrKpsSxwsd2VoOgBsO3Is5Pi9uxk2hTW5-34YisXRKezjd3CFBIxZX2VWXetNTrg2WgP9NOeXkkIAINItVBuPARQIIDYCElzEBu8qXcJmiv1za3lLwxclgYlbQMkccFr5KFhDPouL5rxboR6ibpeBbpk5_7DPxHu8aVSDI4uixT28BDdkgOJOXLFlMFoJh0VGlagu-BcOLMkr6HRm_JD4wxYeB8vfwApKwmNH9YOsa97ZW1DK56aideWCTzy4dyi7yIxl-rRuiJ1xdtgZXGgmbli2uIgG3EZnmfak_89xtJbw9pzDZHuBx4i6qks8RVwK-o2qSg9152p0IxSviFknj-lTImyjX-9_S1HJ9-WK0]--></g></svg>