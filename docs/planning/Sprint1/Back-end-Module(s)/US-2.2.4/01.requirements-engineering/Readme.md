# US2.2.4 – Register and Update Storage Areas

## 1. Requirements Engineering

### 1.1. User Story Description

**As a Port Authority Officer, I want to register and update storage areas, so that (un)loading and storage operations can be assigned to the correct locations within the port.**

---

### 1.2. Customer Specifications and Clarifications

**From the specifications document and client meetings:**

* Each storage area must have:

  * A **unique identifier** (system-generated).
  * **Type** (e.g., Yard, Warehouse).
  * **Name** and **Description** (optional).
  * **Maximum capacity** in TEUs (calculated by Bays × Rows × Tiers).
  * **Current occupancy** in TEUs.
  * Optional assignment to **specific docks**, with **distances (dock → area)** manually provided.

* Default behavior:

  * By default, a storage area can serve **all docks**.
  * Yards may be restricted to a **subset of docks** (usually the closest ones).

* Updates must not allow **current occupancy > maximum capacity**.

* Distances must always be stored explicitly.

* Every change (create/update) must be **logged for audit purposes**.

**From forum:**

> **Question:** Can storage areas serve multiple docks?
> **Answer:** Yes, but only some (e.g., yards).

---

### 1.3. Acceptance Criteria

* **AC01:** A storage area must have a unique identifier generated by the system.
* **AC02:** `Name`, `Type`, and capacity constraints must be mandatory.
* **AC03:** Occupancy must **never exceed** maximum capacity.
* **AC04:** Storage areas can serve all docks by default, but may also be restricted to a defined subset (e.g., yards).
* **AC05:** Distances between docks and storage areas must be explicitly recorded.
* **AC06:** Officer must be able to register a new storage area via `POST /api/storageareas`.
* **AC07:** Officer must be able to update details of an existing storage area via `PUT` or `PATCH /api/storageareas/{id}`.
* **AC08:** System must reject invalid updates (e.g., occupancy > capacity, invalid dock assignments).
* **AC09:** Actions (create/update) must be persisted in the **audit log**.

---

### 1.4. Found Dependencies

* **Dock Management module** – to validate docks referenced by storage areas.
* **Audit Logging system** – to track who created/updated storage areas and when.
* **Container management module (future)** – to link container placement to available storage slots.

---

### 1.5. Input and Output Data

**Input Data:**

* **CreatingStorageAreaDto**

  * Name
  * Description (optional, default = “No description”)
  * Type (`Yard` / `Warehouse`)
  * MaxBays, MaxRows, MaxTiers
    → MaxCapacityTeu = `MaxBays × MaxRows × MaxTiers`
  * Distances to docks (`List<StorageAreaDockDistanceDto>`)

* **UpdatingStorageAreaDto** (optional fields for patch)

  * Description
  * Type
  * Distances
  * Capacity changes (only if they don’t break current occupancy rule)

**Output Data:**

* **StorageAreaDto**

  * Id
  * Name
  * Description
  * Type
  * MaxBays, MaxRows, MaxTiers
  * MaxCapacityTeu
  * CurrentCapacityTeu
  * Distances to docks

* **Response Messages**

  * Success (201 Created, 200 OK)
  * Validation errors (400 Bad Request)
  * Not found (404)
  * Conflict when business rules are violated (409)

---

### 1.6. System Sequence Diagram (SSD)

![SSD](./puml/us2.2.4-sequence-diagram.svg)

---

### 1.7. Other Relevant Remarks

* Business rules (capacity validation, dock assignments, occupancy constraints) must be enforced at the **domain layer**.
* Audit log must capture:

  * Officer ID
  * Operation type (create/update)
  * Timestamp
  * StorageAreaId and details changed
* This US provides the basis for **logistics optimization** in future USs, since dock–storage distances will be critical for scheduling.
