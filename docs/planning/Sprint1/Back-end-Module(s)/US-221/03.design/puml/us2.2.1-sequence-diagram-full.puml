@startuml
' ==========================================================
' Sequence Diagram – US2.2.1 (Create and Manage Vessel Types)
' Author: Jorge Ubaldo Rodrigues
' Context: Port Management – Vessel Type Module
' Updated: includes Mappers and Interfaces
' ==========================================================

actor "Port Authority Officer" as Officer
boundary "API Layer\n(Controller)\n<<uses IVesselTypeService>>" as Controller
control "Application Layer\n(VesselTypeService)\n(implements IVesselTypeService)" as Service
control "Mapper\n(VesselTypeMappers)" as Mappers
control "Factory\n(VesselTypeFactory)" as Factory
entity "Repository\n<<interface>>\n(IVesselTypeRepository)" as Repo
entity "UnitOfWork\n<<interface>>\n(IUnitOfWork)" as UoW
collections "Audit/Logs\n(ILogger / Serilog)" as Log

' ==========================================================
' CREATE VESSEL TYPE
' ==========================================================
== Create ==

Officer -> Controller : POST /api/vesseltypes\nBody: CreatingVesselTypeDto
Controller -> Service : AddAsync(dto)  <<calls IVesselTypeService.AddAsync>>
Service -> Repo : GetByNameAsync(dto.Name)
Repo --> Service : null (no duplicate found)

Service -> Service : Validate name & constraints
Service -> Factory : CreateBasicVesselType(dto)
Factory --> Service : VesselType (entity)

Service -> Repo : AddAsync(entity)
Repo --> Service : Entity persisted

Service -> UoW : CommitAsync()
UoW --> Service : Transaction committed

Service -> Mappers : CreateDtoVesselType(entity)
Mappers --> Service : VesselTypeDto

Service -> Log : Log(CREATE, officerId, vesselTypeId, SUCCESS)
Service --> Controller : VesselTypeDto
Controller --> Officer : 201 Created (VesselTypeDto)


' ==========================================================
' UPDATE VESSEL TYPE
' ==========================================================
== Update ==

Officer -> Controller : PUT /api/vesseltypes/{id}\nBody: UpdateVesselTypeDto
Controller -> Service : UpdateAsync(id, dto)  <<calls IVesselTypeService.UpdateAsync>>

Service -> Repo : GetByIdAsync(id)
Repo --> Service : VesselType (existing entity)

Service -> Service : Validate updates\n(unique name, positive dimensions)
Service -> Repo : Save(updated entity)  <<IVesselTypeRepository.Save/Update>>
Repo --> Service : Entity updated

Service -> UoW : CommitAsync()
UoW --> Service : Transaction committed

Service -> Mappers : CreateDtoVesselType(updated)
Mappers --> Service : VesselTypeDto

Service -> Log : Log(UPDATE, officerId, vesselTypeId, SUCCESS)
Service --> Controller : VesselTypeDto
Controller --> Officer : 200 OK (VesselTypeDto)


' ==========================================================
' SEARCH VESSEL TYPES
' ==========================================================
== Search ==

Officer -> Controller : GET /api/vesseltypes/filter?query=pan
Controller -> Service : FilterAsync(name, description, query)  <<calls IVesselTypeService.FilterAsync>>

Service -> Repo : FilterAsync(name, description, query)  <<IVesselTypeRepository.FilterAsync>>
Repo --> Service : List<VesselType>

Service -> Mappers : CreateDtoVesselType(list)
Mappers --> Service : List<VesselTypeDto>

Service -> Log : Log(SEARCH, officerId, query, SUCCESS)
Service --> Controller : List<VesselTypeDto>
Controller --> Officer : 200 OK (List<VesselTypeDto))


@enduml
