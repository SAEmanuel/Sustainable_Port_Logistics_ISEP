@startuml
actor Client
boundary StaffMembersController
entity StaffMemberService
entity StaffMemberRepository
entity QualificationRepository
entity UnitOfWork
entity StaffMemberFactory

== Get All Staff Members ==
Client -> StaffMembersController: GET /api/staffmembers
StaffMembersController -> StaffMemberService: GetAllAsync()
StaffMemberService -> StaffMemberRepository: GetAllAsync()
StaffMemberRepository --> StaffMemberService: List<StaffMember>
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: List<StaffMemberDto>
StaffMembersController --> Client: 200 OK List<StaffMemberDto>

== Get By ID ==
Client -> StaffMembersController: GET /api/staffmembers/{id}
StaffMembersController -> StaffMemberService: GetByIdAsync(StaffMemberId)
StaffMemberService -> StaffMemberRepository: GetByIdAsync(id)
StaffMemberRepository --> StaffMemberService: StaffMember or null
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: StaffMemberDto or 404
StaffMembersController --> Client: 200 OK or 404

== Get By Qualifications ==
Client -> StaffMembersController: GET /api/staffmembers/by-qualifications\nBody: CodesListDto
StaffMembersController -> StaffMemberService: GetByQualificationsAsync(list<string>)
StaffMemberService -> QualificationRepository: GetQualificationByCodeAsync(code) for each code
QualificationRepository --> StaffMemberService: QualificationId list
StaffMemberService -> StaffMemberRepository: GetByQualificationsAsync(QualificationId list)
StaffMemberRepository --> StaffMemberService: List<StaffMember>
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: List<StaffMemberDto>
StaffMembersController --> Client: 200 OK

== Get By Exact Qualifications ==
Client -> StaffMembersController: GET /api/staffmembers/by-exact-qualifications\nBody: CodesListDto
StaffMembersController -> StaffMemberService: GetByExactQualificationsAsync(list<string>)
StaffMemberService -> QualificationRepository: GetQualificationByCodeAsync(code) for each code
QualificationRepository --> StaffMemberService: QualificationId list
StaffMemberService -> StaffMemberRepository: GetByExactQualificationsAsync(QualificationId list)
StaffMemberRepository --> StaffMemberService: List<StaffMember>
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: List<StaffMemberDto>
StaffMembersController --> Client: 200 OK

== Get By Mecanographic Number ==
Client -> StaffMembersController: GET /api/staffmembers/mec/{mec}
StaffMembersController -> StaffMemberService: GetByMecNumberAsync(mec)
StaffMemberService -> StaffMemberRepository: GetByMecNumberAsync(mec)
StaffMemberRepository --> StaffMemberService: StaffMember or null
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: StaffMemberDto or 404
StaffMembersController --> Client: 200 OK or 404

== Get By Name ==
Client -> StaffMembersController: GET /api/staffmembers/name/{name}
StaffMembersController -> StaffMemberService: GetByNameAsync(name)
StaffMemberService -> StaffMemberRepository: GetByNameAsync(name)
StaffMemberRepository --> StaffMemberService: List<StaffMember>
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: List<StaffMemberDto> or 404
StaffMembersController --> Client: 200 OK or 404

== Get By Status ==
Client -> StaffMembersController: GET /api/staffmembers/status/{status}
StaffMembersController -> StaffMemberService: GetByStatusAsync(status)
StaffMemberService -> StaffMemberRepository: GetByStatusAsync(status)
StaffMemberRepository --> StaffMemberService: List<StaffMember>
StaffMemberService -> StaffMemberFactory: MapToDto()
StaffMemberService --> StaffMembersController: List<StaffMemberDto>
StaffMembersController --> Client: 200 OK

== Create Staff Member ==
Client -> StaffMembersController: POST /api/staffmembers\nCreatingStaffMemberDto
StaffMembersController -> StaffMemberService: AddAsync(dto)
StaffMemberService -> StaffMemberRepository: EmailIsInTheSystem(email)
StaffMemberRepository --> StaffMemberService: bool
StaffMemberService -> StaffMemberRepository: PhoneIsInTheSystem(phone)
StaffMemberRepository --> StaffMemberService: bool
StaffMemberService -> QualificationRepository: GetQualificationByCodeAsync(code) foreach
QualificationRepository --> StaffMemberService: QualificationId list
StaffMemberService -> StaffMemberFactory: CreateStaffMember(dto, mecNum, qualificationIds)
StaffMemberService -> StaffMemberRepository: AddAsync(staffMember)
StaffMemberService -> UnitOfWork: CommitAsync()
UnitOfWork --> StaffMemberService: success
StaffMemberService -> StaffMemberFactory: CreateStaffMemberDto(staffMember, qualificationCodes)
StaffMemberService --> StaffMembersController: StaffMemberDto
StaffMembersController --> Client: 201 Created

== Update Staff Member ==
Client -> StaffMembersController: PUT /api/staffmembers/update/\nUpdateStaffMemberDto
StaffMembersController -> StaffMemberService: UpdateAsync(dto)
StaffMemberService -> StaffMemberRepository: GetByMecNumberAsync(mec)
StaffMemberRepository --> StaffMemberService: StaffMember or null
StaffMemberService -> StaffMemberRepository: EmailIsInTheSystem(email) (optional)
StaffMemberService -> StaffMemberRepository: PhoneIsInTheSystem(phone) (optional)
StaffMemberService -> StaffMember: Update properties
StaffMemberService -> UnitOfWork: CommitAsync()
UnitOfWork --> StaffMemberService: success
StaffMemberService -> StaffMemberFactory: CreateStaffMemberDto(staffMember, qualificationCodes)
StaffMemberService --> StaffMembersController: StaffMemberDto or 404
StaffMembersController --> Client: 200 OK or 404

== Toggle Staff Member Status ==
Client -> StaffMembersController: PUT /api/staffmembers/toggle/{mec}
StaffMembersController -> StaffMemberService: ToggleAsync(mec)
StaffMemberService -> StaffMemberRepository: GetByMecNumberAsync(mec)
StaffMemberRepository --> StaffMemberService: StaffMember or null
StaffMemberService -> StaffMember: ToggleStatus()
StaffMemberService -> UnitOfWork: CommitAsync()
UnitOfWork --> StaffMemberService: success
StaffMemberService -> StaffMemberFactory: CreateStaffMemberDto(staffMember, qualificationCodes)
StaffMemberService --> StaffMembersController: StaffMemberDto or 404
StaffMembersController --> Client: 200 OK or 404

@enduml
